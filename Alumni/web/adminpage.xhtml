<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                template="./templates/standardTemplate.xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://xmlns.jcp.org/jsf/core">

    <ui:define name="nav">
        <li><h:link class="align-right" value="Registrierung" outcome="registrierung" /></li>
        <li><h:link class="align-right" value="Fotogalerie" outcome="fotogalerie" /></li>
        <li><h:link class="align-right" value="Events" outcome="events" /></li>
        <li><h:link class="align-right" value="News" outcome="news" /></li>
        <li><h:link class="align-right" value="Home" outcome="index" /></li>
    </ui:define>

    <ui:define name="content">

        <h:form id="form">
            <f:metadata>
                <f:viewAction action="#{accessController.jumpOutOfPageByAccess(userDAO.currentUser)}" />
            </f:metadata>
            
            <h1>Beiträge verfassen</h1>
            <h:outputLabel value="Titel: "></h:outputLabel>
            <p:inputText id="title" value="#{agendaService.title}"></p:inputText>
            <br></br>
            <p:outputLabel for="popup" value="Datum: "></p:outputLabel>
            <p:calendar id="popup" value="#{agendaService.date}" />
            <br></br>
            <p:outputLabel value="Ort: "></p:outputLabel>
            <p:inputText id="place" value="#{agendaService.place}"></p:inputText>
            <br></br>
            <h:outputLabel value="Inhalt: "></h:outputLabel>

            <p:editor id="editor" widgetVar="editorWidget" value="#{agendaService.content}" width="600" />
            <br></br>
            <h:commandButton value="Veroeffentlichen" type="submit" action="#{agendaService.createNewPost()}"/>

            <h1>Alle Beiträge</h1>
            <p:growl id="growl" showDetail="true" sticky="false" />
            <h:outputText value="#{agendaService.date}">
                <f:convertDateTime pattern="dd.MM.yyyy" timeZone="GMT+2"/>
            </h:outputText>

            <p:dataList id="list" value="#{agendaService.selectAllPosts()}" var="post" type="ordered" emptyMessage="Keine Einträge zurzeit">

                <p:panel id="basic"  style="margin-bottom:20px">
                    <f:facet name="header">
                        <p:inplace editor="true">
                            <p:ajax event="save" listener="#{agendaService.editPost(post)}" update=":form:growl"/>
                            <p:inputText value="#{post.title}"/>
                        </p:inplace>

                        <p:commandButton id="button" value="Löschen" immediate="true" style="float: right;" update=":form:growl">
                            <f:ajax render="list" listener="#{agendaService.deletePost(post)}"/>
                        </p:commandButton>
                    </f:facet>
                    <f:facet name="footer">
                        <p:outputLabel value="von #{userDAO.currentUser.userName} und findet statt in: "/>
                        <p:inplace editor="true">

                            <p:ajax event="save" listener="#{agendaService.editPost(post)}" update=":form:growl"/>
                            <p:inputText value="#{post.place}"/>

                        </p:inplace>
                       

                    </f:facet>
                    
                    <h:panelGrid columns="2" cellpadding="5">
                        <p:inplace editor="true">
                            <p:ajax event="save" listener="#{agendaService.editPost(post)}" update=":form:growl"/>
                            <p:editor value="#{post.content}" />
                        </p:inplace>

                    </h:panelGrid>
                </p:panel>
            </p:dataList>

            <h1>Neuzugänge verwalten</h1>
            <p:dataTable id="table" var="user" value="#{userService.selectAllNonAllowedUsers()}" emptyMessage="Keine neuen User zurzeit">
                <p:column headerText="Vorname">
                    <h:outputText value="#{user.firstName}" />
                </p:column>

                <p:column headerText="Nachname">
                    <h:outputText value="#{user.lastName}" />
                </p:column>

                <p:column headerText="Email">
                    <h:outputText value="#{user.email}" />
                </p:column>

                <p:column headerText="Controls">

                    <h:commandButton id="allowButton" value="Zulassen" immediate="true" actionListener="#{userService.allow(user)}">

                    </h:commandButton>
                    <h:commandButton id="denyButton" value="Ablehnen" immediate="true" actionListener="#{userService.deny(user)}">

                    </h:commandButton>

                </p:column>
            </p:dataTable>
        </h:form>
    </ui:define>

</ui:composition>
